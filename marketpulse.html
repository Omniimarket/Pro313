<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MarketPulse - Volume Profile</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f7fa;
      color: #333;
    }
    
    #ticker-buttons {
      margin: 20px 0;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    .ticker-btn {
      padding: 10px 15px;
      background-color: #4361ee;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    
    .ticker-btn:hover {
      background-color: #3a56d4;
    }
    
    .ticker-btn.active {
      background-color: #2f4ab3;
    }
    
    #chart-container {
      width: 100%;
      height: 500px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    #signals {
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .signal-title {
      font-size: 1.5rem;
      margin-top: 0;
      color: #4361ee;
    }
    
    .signal-value {
      font-size: 1.2rem;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .positive {
      color: #26a69a;
    }
    
    .negative {
      color: #ef5350;
    }
    
    .volume-clusters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 15px 0;
    }
    
    .cluster-pill {
      background-color: #4361ee;
      color: white;
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .gaps-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    
    .gap-direction {
      flex: 1;
    }
    
    .gap-values {
      margin-top: 10px;
    }
    
    .gap-value {
      padding: 5px 10px;
      margin-bottom: 5px;
      border-radius: 4px;
      font-size: 0.9rem;
    }
    
    .gap-above {
      background-color: rgba(38, 166, 154, 0.1);
      color: #26a69a;
    }
    
    .gap-below {
      background-color: rgba(239, 83, 80, 0.1);
      color: #ef5350;
    }
  </style>
</head>
<body>
  <div id="ticker-buttons"></div>
  <div id="chart-container"></div>
  <div id="signals"></div>

  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.min.js"></script>
  
  <script>
    // Complete volume profile data
    const volumeProfileData = {
      "AAPL": {
        "POC": 198.58,
        "POC_Move": -2.92,
        "VAL": 195.64,
        "VAH": 212.56,
        "Volume_Clusters": [197.08, 197.58, 198.08],
        "Gaps_Above": [203.58, 208.58],
        "Gaps_Below": [193.58, 188.58],
        "Current_Price": 198.58,
        "Price_Change_Pct": -1.45
      },
      "NVDA": {
        "POC": 135.17,
        "POC_Move": -7.5,
        "VAL": 114.2,
        "VAH": 144.34,
        "Volume_Clusters": [133.67, 134.17, 134.67],
        "Gaps_Above": [140.17, 145.17],
        "Gaps_Below": [130.17, 125.17],
        "Current_Price": 135.17,
        "Price_Change_Pct": -5.25
      },
      "TSLA": {
        "POC": 342.83,
        "POC_Move": 16.77,
        "VAL": 277.17,
        "VAH": 361.07,
        "Volume_Clusters": [341.33, 341.83, 342.33],
        "Gaps_Above": [347.83, 352.83],
        "Gaps_Below": [337.83, 332.83],
        "Current_Price": 342.83,
        "Price_Change_Pct": 5.15
      }
    };

    // Wait for page to fully load
    window.addEventListener('load', function() {
      const tickerButtons = document.getElementById('ticker-buttons');
      const chartContainer = document.getElementById('chart-container');
      const signalsDiv = document.getElementById('signals');
      
      // Create ticker buttons
      Object.keys(volumeProfileData).forEach(ticker => {
        const btn = document.createElement('button');
        btn.className = 'ticker-btn';
        btn.textContent = ticker;
        btn.addEventListener('click', () => updateChart(ticker));
        tickerButtons.appendChild(btn);
      });
      
      // Initialize with first ticker
      updateChart(Object.keys(volumeProfileData)[0]);
      
      // Set first button as active
      document.querySelector('.ticker-btn').classList.add('active');
    });

    function updateChart(ticker) {
      const data = volumeProfileData[ticker];
      
      // Update active button
      document.querySelectorAll('.ticker-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent === ticker) btn.classList.add('active');
      });
      
      // Clear and recreate chart
      chartContainer.innerHTML = '';
      const chart = LightweightCharts.createChart(chartContainer, {
        width: chartContainer.clientWidth,
        height: chartContainer.clientHeight,
        layout: {
          backgroundColor: '#ffffff',
          textColor: '#333',
        },
        grid: {
          vertLines: { color: 'rgba(0, 0, 0, 0.05)' },
          horzLines: { color: 'rgba(0, 0, 0, 0.05)' },
        }
      });
      
      // Add candle series with mock data
      const candleSeries = chart.addCandlestickSeries({
        upColor: '#26a69a',
        downColor: '#ef5350',
        borderDownColor: '#ef5350',
        borderUpColor: '#26a69a',
        wickDownColor: '#ef5350',
        wickUpColor: '#26a69a',
      });
      
      const now = Math.floor(Date.now() / 1000);
      const candles = [];
      for (let i = 30; i >= 0; i--) {
        const base = data.POC;
        const open = base + (Math.random() - 0.5) * 10;
        const close = open + (Math.random() - 0.5) * 5;
        candles.push({
          time: now - i * 86400,
          open: open,
          high: Math.max(open, close) + Math.random() * 3,
          low: Math.min(open, close) - Math.random() * 3,
          close: close
        });
      }
      candleSeries.setData(candles);
      
      // Add volume profile lines
      candleSeries.createPriceLine({
        price: data.POC,
        color: '#4361ee',
        lineWidth: 2,
        lineStyle: 2, // Dashed
        title: 'POC'
      });
      
      candleSeries.createPriceLine({
        price: data.VAL,
        color: '#ef5350',
        lineWidth: 2,
        title: 'VAL'
      });
      
      candleSeries.createPriceLine({
        price: data.VAH,
        color: '#26a69a',
        lineWidth: 2,
        title: 'VAH'
      });
      
      // Add gap areas
      data.Gaps_Above.forEach(price => {
        candleSeries.createPriceLine({
          price: price,
          color: 'rgba(38, 166, 154, 0.3)',
          lineWidth: 1,
          lineStyle: 1, // Dotted
          title: 'Gap Above'
        });
      });
      
      data.Gaps_Below.forEach(price => {
        candleSeries.createPriceLine({
          price: price,
          color: 'rgba(239, 83, 80, 0.3)',
          lineWidth: 1,
          lineStyle: 1, // Dotted
          title: 'Gap Below'
        });
      });
      
      // Update signals panel
      signalsDiv.innerHTML = `
        <h2 class="signal-title">${ticker} Volume Profile</h2>
        <div class="signal-value">
          Current Price: $${data.Current_Price.toFixed(2)}
          <span class="${data.POC_Move >= 0 ? 'positive' : 'negative'}">
            (${data.POC_Move >= 0 ? '+' : ''}${data.POC_Move.toFixed(2)}, ${data.Price_Change_Pct >= 0 ? '+' : ''}${data.Price_Change_Pct.toFixed(2)}%)
          </span>
        </div>
        
        <div class="signal-value">
          POC: $${data.POC.toFixed(2)} | VAL: $${data.VAL.toFixed(2)} | VAH: $${data.VAH.toFixed(2)}
        </div>
        
        <div class="volume-clusters">
          <strong>Volume Clusters:</strong>
          ${data.Volume_Clusters.map(price => `
            <div class="cluster-pill">$${price.toFixed(2)}</div>
          `).join('')}
        </div>
        
        <div class="gaps-container">
          <div class="gap-direction">
            <strong>Gaps Above (Resistance):</strong>
            <div class="gap-values">
              ${data.Gaps_Above.map(price => `
                <div class="gap-value gap-above">$${price.toFixed(2)}</div>
              `).join('')}
            </div>
          </div>
          
          <div class="gap-direction">
            <strong>Gaps Below (Support):</strong>
            <div class="gap-values">
              ${data.Gaps_Below.map(price => `
                <div class="gap-value gap-below">$${price.toFixed(2)}</div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
      
      // Handle window resize
      new ResizeObserver(() => {
        chart.applyOptions({
          width: chartContainer.clientWidth,
          height: chartContainer.clientHeight
        });
      }).observe(chartContainer);
    }
  </script>
</body>
</html>
